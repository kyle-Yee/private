<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dcits.govsbu.sd.taxbankplatform.tbpStatic.mapper.ImgMapper">
	<!--mybatis ehcache缓存配置,以下两个<cache>标签二选一,第一个可以输出日志,第二个不输出日志 -->
	<cache type="org.mybatis.caches.ehcache.LoggingEhcache"/> 
	<!-- <cache type="org.mybatis.caches.ehcache.EhcacheCache"/> -->
	
	<resultMap id="imgMap" type="com.dcits.govsbu.sd.taxbankplatform.tbpStatic.model.ImgEntity">
		<id property="id" column="pi_id"/>
		<result property="cityId" column="region_id" />
		<result property="cityName" column="region_name" />
		<result property="pitId" column="pit_id" />
		<result property="imgName" column="pit_name"/>
		<result property="imgCode" column="pit_code"/>
		<result property="imgUrl" column="pi_img_url"/>
		<result property="order" column="pi_display_order"/>
		<result property="targetUrl" column="pi_target_url"/>
		<result property="enabled" column="enabled"/>
		<result property="creatorid" column="creatorid"/>
		<result property="createtime" column="createtime"/>
		<result property="updatorid" column="updatorid"/>
		<result property="updatetime" column="updatetime"/>
	</resultMap>
	
	<!-- 搜索数据 -->
	<select id="queryListByPage" parameterType="map" resultMap="imgMap" flushCache="true" useCache="true">
		SELECT
		pi.pi_id,
		pi.pi_img_url,
		pi.pi_display_order,
		pi.pi_target_url,
		pi.enabled,
		pit.pit_name,
		r.region_name
		FROM tb_portal_imgs pi LEFT JOIN tb_portal_img_type pit ON pi.pit_id = pit.pit_id LEFT JOIN tb_regions r ON pi.region_id = r.region_id
		<where>
			<if test="imgName != null and imgName != ''">
			pit.pit_name LIKE CONCAT('%','${imgName}','%' )
			</if>
			and pi.region_id = #{cityId}
		</where>
	</select>
	
	<!-- 搜索ID -->
	<select id="findIdByCode" parameterType="map" resultMap="imgMap" flushCache="true" useCache="true">
		SELECT pit_id
		FROM tb_portal_img_type
		where pit_code = #{imgCode} and enabled = 'Y'
	</select>
	
	<!-- 点击编辑按钮时候查询单条数据 -->
	<select id="findById" parameterType="String" resultMap="imgMap" flushCache="true" useCache="true">
		SELECT
		pi.pi_id,
		pi.pi_img_url,
		pi.pi_display_order,
		pi.pi_target_url,
		pi.enabled,
		pit.pit_name,
		pit.pit_code,
		r.region_name
		FROM tb_portal_imgs pi LEFT JOIN tb_portal_img_type pit ON pi.pit_id = pit.pit_id LEFT JOIN tb_regions r ON pi.region_id = r.region_id
		where pi.pi_id = #{id}
	</select>
	
	<!-- 初始化下拉框 -->
	<select id="findImgType" parameterType="String" resultMap="imgMap" flushCache="true" useCache="true">
		SELECT *
		FROM tb_portal_img_type where enabled = 'Y'
	</select>
	
	<!-- 搜索ID检测排序 -->
	<select id="findOrder" parameterType="com.dcits.govsbu.sd.taxbankplatform.tbpStatic.model.ImgEntity" resultMap="imgMap" flushCache="true" useCache="true">
		SELECT pi.pi_id
		FROM tb_portal_imgs pi LEFT JOIN tb_portal_img_type pit ON pi.pit_id = pit.pit_id
		where pi.pi_display_order = #{order} and pit.pit_code = #{imgCode} and pi.enabled = 'Y' and pi.region_id = #{cityId}
	</select>
	
	<!-- 搜索ID检测code -->
	<select id="findName" parameterType="com.dcits.govsbu.sd.taxbankplatform.tbpStatic.model.ImgEntity" resultMap="imgMap" flushCache="true" useCache="true">
		SELECT pi.pi_id
		FROM tb_portal_imgs pi LEFT JOIN tb_portal_img_type pit ON pi.pit_id = pit.pit_id
		where pit.pit_code = #{imgCode} and pi.enabled = 'Y' and pi.region_id = #{cityId}
	</select>
	
	<!-- 插入数据 -->
	<insert id="insert" parameterType="com.dcits.govsbu.sd.taxbankplatform.tbpStatic.model.ImgEntity" useGeneratedKeys="true" keyProperty="pi_id">
		insert into tb_portal_imgs (
			pi_id,region_id,pit_id,pi_img_url,pi_display_order,pi_target_url,enabled,creatorid,createtime,updatorid,updatetime
			)   
		values (
     		#{id},
			#{cityId},
			#{pitId},
			#{imgUrl},
			#{order},
			#{targetUrl},
			#{enabled},
			#{creatorid},
			#{createtime},
			#{updatorid},
			#{updatetime}
			)  
	</insert>
	
	<!-- 更新数据 -->
	<update id="update" parameterType="com.dcits.govsbu.sd.taxbankplatform.tbpStatic.model.ImgEntity" flushCache="true">
		update tb_portal_imgs
		<set>
			<if test="order != null and order != ''">
				pi_display_order = #{order},
			</if>
			<if test="imgUrl != null and imgUrl != ''">
				pi_img_url = #{imgUrl},
			</if>
			<if test="targetUrl != null and targetUrl != ''">
				pi_target_url = #{targetUrl},
			</if>
			<if test="enabled != null and enabled != ''">
				enabled = #{enabled},
			</if>
			updatorid = #{updatorid},
			updatetime = now()
		</set>
		where pi_id = #{id}
	</update>
</mapper>