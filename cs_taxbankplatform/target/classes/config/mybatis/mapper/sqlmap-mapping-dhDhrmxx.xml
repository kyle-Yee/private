<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.dcits.govsbu.sd.taxbankplatform.dkxx.mapper.DhDhrmxxMapper" >
  	<resultMap id="sxjgxxMap" type="com.dcits.govsbu.sd.taxbankplatform.dkxx.model.DhSxjgxx">
	<id column="SXJGXX_ID" property="sxjgxxId"/>
    <result column="BUSINESSID" property="businessid"  />
    <result column="INDNAME" property="indname"  />
    <result column="INDCERTTYPE" property="indcerttype"  />
    <result column="INDCERTID" property="indcertid"  />
    <result column="ENTNAME" property="entname"  />
    <result column="ENTCREDITID" property="entcreditid"  />
    <result column="ENTREGID" property="entregid"  />
    <result column="ENTTAXID" property="enttaxid"  />
    <result column="APPROVEDATE" property="approvedate"  />
    <result column="ADMISSIONRESULT" property="admissionresult"  />
    <result column="CONTRACTAMT" property="contractamt"  />
    <result column="CONTRACTTERM" property="contractterm"  />
    <result column="CONTRACTRATE" property="contractrate"  />
    <result column="PAYBACKTYPE" property="paybacktype"  />
    <result column="createtime" property="cjsj"  />
    <result column="HTH" property="hth"  />
    <result column="HTZT" property="htzt"  />
    <result column="enabled" property="enabled"  />
    <result column="channelid" property="channelid"  />
	</resultMap>
	<resultMap id="failureMap" type="com.dcits.govsbu.sd.taxbankplatform.dkxx.model.DhFailure">
	<id column="FAILURE_ID" property="failureId"/>
    <result column="BUSINESSID" property="businessid"  />
    <result column="ENTNAME" property="entname"  />
    <result column="ENTCREDITID" property="entcreditid"  />
    <result column="ENTREGID" property="entregid"  />
    <result column="ENTTAXID" property="enttaxid"  />
    <result column="APPROVEDATE" property="approvedate"  />
    <result column="createtime" property="cjsj"  />
    <result column="enabled" property="enabled"  />
    <result column="channelid" property="channelid"  />
	</resultMap>
	 <resultMap id="dkjsxxMap" type="com.dcits.govsbu.sd.taxbankplatform.dkxx.model.DhDkjsxx">
	<id column="DKJSXX_ID" property="dkjsxxId"/>
    <result column="BUSINESSID" property="businessid"  />
    <result column="INDNAME" property="indname"  />
    <result column="INDCERTTYPE" property="indcerttype"  />
    <result column="INDCERTID" property="indcertid"  />
    <result column="ENTNAME" property="entname"  />
    <result column="ENTCREDITID" property="entcreditid"  />
    <result column="ENTREGID" property="entregid"  />
    <result column="ENTTAXID" property="enttaxid"  />
    <result column="SERIALNO" property="serialno"  />
    <result column="ENDTYPE" property="endtype"  />
    <result column="ENDDATE" property="enddate"  />
    <result column="ENDBALANCE" property="endbalance"  />
    <result column="OVERDUECOUNT" property="overduecount"  />
    <result column="MAXOVERDUEDAYS" property="maxoverduedays"  />
    <result column="ENDCLASS" property="endclass"  />
    <result column="BH" property="bh"  />
    <result column="HTZT" property="htzt"  />
    <result column="enabled" property="enabled"  />
    <result column="channelid" property="channelid"  />
	</resultMap>
	<resultMap id="allMap" type="com.dcits.govsbu.sd.taxbankplatform.dkxx.model.DhSxjgxx">
	<id column="SXJGXX_ID" property="sxjgxxId"/>
    <result column="BUSINESSID" property="businessid"  />
    <result column="INDNAME" property="indname"  />
    <result column="INDCERTTYPE" property="indcerttype"  />
    <result column="INDCERTID" property="indcertid"  />
    <result column="ENTNAME" property="entname"  />
    <result column="ENTCREDITID" property="entcreditid"  />
    <result column="ENTREGID" property="entregid"  />
    <result column="ENTTAXID" property="enttaxid"  />
    <result column="APPROVEDATE" property="approvedate"  />
    <result column="ADMISSIONRESULT" property="admissionresult"  />
    <result column="CONTRACTAMT" property="contractamt"  />
    <result column="CONTRACTTERM" property="contractterm"  />
    <result column="CONTRACTRATE" property="contractrate"  />
    <result column="PAYBACKTYPE" property="paybacktype"  />
     <result column="HTH" property="hth"  />
    <result column="HTZT" property="htzt"  />
    <result column="createtime" property="cjsj"  />
    <result column="enabled" property="enabled"  />
    <result column="channelid" property="channelid"  />
    <association property="dkjsxx" column="dkjsxxId" javaType="com.dcits.govsbu.sd.taxbankplatform.dkxx.model.DhDkjsxx" >
    <id column="DKJSXX_ID" property="dkjsxxId"/>
    <result column="BUSINESSID" property="businessid"  />
    <result column="INDNAME" property="indname"  />
    <result column="INDCERTTYPE" property="indcerttype"  />
    <result column="INDCERTID" property="indcertid"  />
    <result column="ENTNAME" property="entname"  />
    <result column="ENTCREDITID" property="entcreditid"  />
    <result column="ENTREGID" property="entregid"  />
    <result column="ENTTAXID" property="enttaxid"  />
    <result column="SERIALNO" property="serialno"  />
    <result column="ENDTYPE" property="endtype"  />
    <result column="ENDDATE" property="enddate"  />
    <result column="ENDBALANCE" property="endbalance"  />
    <result column="OVERDUECOUNT" property="overduecount"  />
    <result column="MAXOVERDUEDAYS" property="maxoverduedays"  />
    <result column="ENDCLASS" property="endclass"  />
    <result column="enabled" property="enabled"  />
    <result column="channelid" property="channelid"  />
    </association>
	</resultMap>
  <sql id="Base_Column_List" >
    BUSINESSID, INDNAME, INDCERTTYPE, INDCERTID, ENTNAME, ENTCREDITID, ENTREGID, ENTTAXID, 
    SERIALNO, PUTOUTDATE, MATURITY, BUSINESSSUM, BALANCE, OVERDUEAMT, OVERDUETERM, MAXOVERDUETERMS, 
    CJSJ,channelid
  </sql>
  
   
   
   
    <insert id="insertDhDkjsxx" parameterType="java.util.List" useGeneratedKeys="false">
     insert into tb_dh_dkjsxx (DKJSXX_ID,BUSINESSID, INDNAME, INDCERTTYPE,INDCERTID, ENTNAME, ENTCREDITID,ENTREGID, ENTTAXID, SERIALNO,ENDTYPE, ENDDATE, ENDBALANCE,  
       OVERDUECOUNT, MAXOVERDUEDAYS, ENDCLASS,BH,HTZT,channelid)

  values 
     <foreach collection="list" item="item" index="index" separator=",">  
     (
      #{item.dkjsxxId},
      #{item.businessid}, #{item.indname}, #{item.indcerttype}, 
      #{item.indcertid}, #{item.entname}, #{item.entcreditid}, 
      #{item.entregid}, #{item.enttaxid}, #{item.serialno}, 
      #{item.endtype}, #{item.enddate}, #{item.endbalance }, 
      #{item.overduecount}, #{item.maxoverduedays}, #{item.endclass},
      #{item.bh},#{item.htzt},
      #{item.channelid} )
      </foreach>
    
  </insert>
  
  
  <insert id="insertDhsxjgxx" parameterType="java.util.List"  useGeneratedKeys="false">
     
     insert into tb_dh_sxjgxx (SXJGXX_ID,BUSINESSID, INDNAME, INDCERTTYPE, 
      INDCERTID, ENTNAME, ENTCREDITID, 
      ENTREGID, ENTTAXID, APPROVEDATE, 
      ADMISSIONRESULT, CONTRACTAMT, CONTRACTTERM, 
      CONTRACTRATE, PAYBACKTYPE, HTH,HTZT,channelid
      )
     values
     <foreach collection="list" item="item" index="index"  separator="," > 
   	   ( #{item.sxjgxxId},#{item.businessid}, #{item.indname}, #{item.indcerttype}, 
      #{item.indcertid}, #{item.entname}, #{item.entcreditid}, 
      #{item.entregid}, #{item.enttaxid}, #{item.approvedate}, 
      #{item.admissionresult}, #{item.contractamt}, #{item.contractterm}, 
      #{item.contractrate}, #{item.paybacktype},#{item.hth},#{item.htzt}, #{item.channelid})
      </foreach>
       
  </insert>
  <insert id="insertFailure" parameterType="java.util.List"  useGeneratedKeys="false">
     
     insert into tb_dh_failure 
     (FAILURE_ID,BUSINESSID,  ENTNAME, ENTCREDITID, ENTTAXID, APPROVEDATE, channelid
       )
    values  
     <foreach collection="list" item="item" index="index"  separator="," > 
   	  (
   	  #{item.failureId},
   	  #{item.businessid}, #{item.entname}, #{item.entcreditid}, 
       #{item.enttaxid}, #{item.approvedate},  #{item.channelid} ) 
      </foreach>
  </insert>
  <!-- 查询授信数据是否入临时表 -->
 	<select id="querysxjgxxListAll" parameterType="map" resultMap="sxjgxxMap" flushCache="true" useCache="true">
		select * from tb_dh_sxjgxx xx 
		<where>
		    <if test="businessid!=null and businessid!=''">
		         xx.BUSINESSID =#{businessid}
		    </if>
		    <if test="contractrate !=null and contractrate !=''">
		         xx.CONTRACTRATE =#{contractrate}
		    </if>
		    <if test="nsrsbh !=null and nsrsbh !=''">
		         xx.ENTCREDITID =#{nsrsbh} or xx.ENTTAXID=#{nsrsbh}
		    </if>
		      <if test="zjhm !=null and zjhm !=''">
		         xx.INDCERTID =#{zjhm} 
		    </if>
		    <if test="isdesc !=null and isdesc !=''">
		         order by xx.APPROVEDATE desc
		    </if>
		</where>	
	</select>
   <!-- 查询结束信息是否入临时表 -->
 	<select id="querydkjsxxListAll" parameterType="map" resultMap="dkjsxxMap" flushCache="true" useCache="true">
		select * from tb_dh_dkjsxx xx 
		<where>
		    <if test="businessid!=null and businessid!=''">
		         xx.BUSINESSID =#{businessid}
		    </if>
		</where>
		 <if test="isdesc !=null and isdesc !=''">
		         order by xx.ENDDATE desc
		    </if>	
	</select>
	  <!-- 查询失败数据 -->
 	<select id="queryfailureListAll" parameterType="map" resultMap="failureMap" flushCache="true" useCache="true">
		select * from tb_dh_failure xx 
		<where>
		    <if test="businessid!=null and businessid!=''">
		         xx.BUSINESSID =#{businessid}
		    </if>
		</where>	
	</select>
	   <!-- 关联查询授信结束信息 -->
 	<select id="queryListAll" parameterType="map" resultMap="allMap" flushCache="true" useCache="true">
		select xx.BUSINESSID from tb_dh_dkjsxx xx 
		<where>
		    <if test="businessid!=null and businessid!=''">
		         xx.BUSINESSID =#{businessid}
		    </if>
		</where>	
	</select>
	<!-- 更新授信数据信息 -->
	<update id="changedkjsxx" parameterType="com.dcits.govsbu.sd.taxbankplatform.dkxx.model.DhSxjgxx"  flushCache="true">
		update tb_dh_sxjgxx
		<set>
		   <if test="contractrate !='' and contractrate !=null">
		       CONTRACTRATE=#{contractrate},
		   </if>
		  <if test="enabled !='' and enabled !=null">
		       enabled=#{enabled}
		  </if>
		</set>
		where DKJSXX_ID = #{dkjsxxId}
	</update>
	<!--  -->
	  <delete id="deleteSxjgxx" parameterType="java.util.List" >
  		delete from  tb_dh_sxjgxx where  date_format(createtime,'%Y-%m-%d') in
  		<foreach collection="list" index="index" item="item" open="(" separator="," close=")" > 
		   	   date_format(#{item},'%Y-%m-%d')
      	</foreach>
  </delete>
</mapper>