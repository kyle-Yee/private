<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.dcits.govsbu.sd.taxbankplatform.taxpdf.mapper.TaxPdfQyjgMapper" >
<cache type="org.mybatis.caches.ehcache.LoggingEhcache"/> 
  <resultMap id="BaseResultMap" type="com.dcits.govsbu.sd.taxbankplatform.taxpdf.model.TaxPdfQyjgEntity" >
		<result property="fddbrxm" column="tth_fddbrxm"/>
		<result property="fddbrsfzjlmdm" column="tth_fddbrsfzjlx_dm" />
		<result property="sfzjlxmc" column="sfzjlxmc" />
		<result property="fddbrsfzjhm" column="tth_fddbrsfzjhm"/>
		<result property="fddbrgddh" column="tthk_fddbrgddh"/>
		<result property="fddbryddh" column="tthk_fddbryddh"/>
		<!-- <collection property="taxQyjgListEntity" ofType="com.dcits.govsbu.sd.taxbankplatform.taxpdf.model.TaxQyjgListEntity"> -->
			<!--股东信息 -->
			<association property="taxQytzfEntity" column="id" javaType="com.dcits.govsbu.sd.taxbankplatform.qytzf.model.TaxQytzfEntity">
				<id column="tthy_id" property="id" />
				<result property="tthyTzfhhhrmc" column="tthy_tzfhhhrmc"/>
				<result property="tthyTzje" column="tthy_tzje"/>
				<result property="tthyTzbl" column="tthy_tzbl"/>
				<result property="tthyTzfjjxzDm" column="tthy_tzfjjxz_dm"/>
			</association>
			<!-- 关联企业 -->
			<association property="taxQyfzjgEntity" column="id" javaType="com.dcits.govsbu.sd.taxbankplatform.qyfzjg.model.TaxQyfzjgEntity">
			    <id column="tthf_id" property="id" />
			    <result column="tthf_fzjghfdmc" property="tthfFzjghfdmc" />
	    	</association>
	<!-- </collection> -->
  </resultMap>
  <!-- 企业结构 -->
	<select id="findByDjxh" parameterType="map" resultMap="BaseResultMap" flushCache="true" useCache="true">
	SELECT 
	ttq.tth_fddbrxm,
	ttq.tth_fddbrsfzjlx_dm,
	td.sfzjlxmc,
	ttq.tth_fddbrsfzjhm,
	ttqk.tthk_fddbrgddh,
	ttqk.tthk_fddbryddh,
	ttqf.tthy_tzfhhhrmc,
	ttqf.tthy_tzje,
	ttqf.tthy_tzbl,
	ttqf.tthy_tzfjjxz_dm,
	ttqg.tthf_fzjghfdmc
	FROM tb_nsryhxx tnx
	LEFT JOIN t_tax_qyjcxx ttq ON tnx.nsryhxx_djxh = ttq.djxh 
	LEFT JOIN t_tax_qyjcxx_kz ttqk ON ttq.djxh = ttqk.djxh
	LEFT JOIN t_tax_qytzf ttqf ON ttqk.djxh = ttqf.djxh
	AND ttqk.sqxh = ttqf.sqxh
	LEFT JOIN t_tax_qyfzjg ttqg ON ttqf.djxh = ttqg.djxh
	LEFT JOIN t_gy_sfzjlx_dm td ON ttq.tth_fddbrsfzjlx_dm = td.sfzjlx_dm
	where tnx.creatorid = #{userid} AND ttqf.sqxh = #{sqxh}
	</select>
	
	 <resultMap id="BaseMap" type="com.dcits.govsbu.sd.taxbankplatform.qytzf.model.TaxQytzfEntity" >
		<id column="tthy_id" property="id" />
		<result property="tthyTzfhhhrmc" column="tthy_tzfhhhrmc"/>
		<result property="tthyTzje" column="tthy_tzje"/>
		<result property="tthyTzbl" column="tthy_tzbl"/>
		<result property="tthyTzfjjxzDm" column="tthy_tzfjjxz_dm"/>
  	</resultMap>
	<select id="findByUserid" parameterType="map" resultMap="BaseMap" flushCache="true" useCache="true">
		SELECT 
			ttqf.tthy_id,
			ttqf.tthy_tzfhhhrmc,
			ttqf.tthy_tzje,
			ttqf.tthy_tzbl,
			ttqf.tthy_tzfjjxz_dm
		FROM tb_nsryhxx tnx
		LEFT JOIN t_tax_qytzf ttqf ON tnx.nsryhxx_djxh = ttqf.djxh
		where tnx.creatorid = #{userid} AND ttqf.sqxh = #{sqxh}
	</select>
</mapper>