<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dcits.govsbu.sd.taxbankplatform.syptzhbgqk.mapper.SyptzhbgqkMapper">
	<!--mybatis ehcache缓存配置,以下两个<cache>标签二选一,第一个可以输出日志,第二个不输出日志 -->
	 
	
	<select id="queryListByPage" parameterType="map" resultType="map"  >
	select t.BUSINESSID,t.ENTNAME,g.nsrsbh, k.hy_mc,l.djzclxmc,t.TBPNAME,(
			SELECT
				h.fp_name
			FROM
				tb_financial_product h
			WHERE
				h.fp_id = t.businessType
		) AS cp_name,f.LOANTIME,f.LOANACCOUNT,h.sfba,h.bafs 
from 
tb_loan_dksq t 
left join  tb_loan_dhsx  f 
on t.BUSINESSID = f.BUSINESSID  left join tb_data_request g on f.ENTCREDITID = g.nsrsbh or f.ENTTAXID = g.nsrsbh
left join  tb_dksq_dgzhba h on f.LOANACCOUNT  = h.yhzh LEFT JOIN (select n.hy_dm,n.hy_mc,m.hy_dm as zldm ,b.hy_dm as lddm, b.hy_sjhydm as mldm from tb_hydm n LEFT JOIN tb_hydm m on n.hy_xlbz = 'Y' and  n.hy_sjhydm = m.hy_dm
LEFT JOIN tb_hydm b on m.hy_zlbz = 'Y' and  m.hy_sjhydm = b.hy_dm ) k on g.HY_DM = k.hy_dm
left join t_djzclx_dm l on g.DJZCLX_DM = l.djclx_dm

				 <where>
			 
				 	<if test="bankId != null and bankId != ''">
						and t.TBPCODE = #{bankId}
					</if>
					 
					 <if test="fpId != null and fpId != ''">
						and t.BUSINESSTYPE = #{fpId}
					</if>
					 <if test="djclxDm != null and djclxDm != ''">
						and l.sjdjzclx_dm = #{djclxDm}
					</if>
					 <if test="hydm != null and hydm != ''">
						and   k.mldm = #{hydm}
					</if>
					<if test="qymc != null and qymc != ''">
						and  t.ENTNAME like '%${qymc}%'
					</if>
					<if test="nsrsbh != null and nsrsbh != ''">
						and   g.nsrsbh = #{nsrsbh}
					</if>
					
					<if test="starttime != null and starttime != ''">
						and  str_to_date(f.LOANTIME ,'%Y-%m-%d')  &gt;= str_to_date( #{starttime} ,'%Y-%m-%d') 
					</if>
					
					<if test="endtime != null and endtime != ''">
						and  str_to_date(f.LOANTIME ,'%Y-%m-%d') &lt;= str_to_date( #{endtime} ,'%Y-%m-%d') 
					</if>
					
					<if test="nsrzgswj != null and nsrzgswj != ''">
						and  g.nsrzgswj like  '${nsrzgswj}%'
					</if>
				</where>
				
				GROUP BY  t.BUSINESSID 
	</select>

 
 



<select id="getHydm"   resultType="map"  >
		select hy_dm as hydm,hy_mc as hymc from tb_hydm where hy_mlbz = 'Y'
</select> 

<select id="getDjzclx"  resultType="map"  >
		select djclx_dm,djzclxmc from t_djzclx_dm where dlbz = 'Y'
</select> 
 
</mapper>