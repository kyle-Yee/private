<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dcits.govsbu.sd.taxbankplatform.statisticalanalysis.mapper.DataRefreshMapper">
	<!--mybatis ehcache缓存配置,以下两个<cache>标签二选一,第一个可以输出日志,第二个不输出日志 -->
	<cache type="org.mybatis.caches.ehcache.LoggingEhcache"/> 

	<!-- 税银互动资料更新 -->
	<resultMap id="dataRefresh" type="com.dcits.govsbu.sd.taxbankplatform.statisticalanalysis.model.DataRefreshEntity">
		<id property="dr_id" column="dr_id"/>
		<result property="region_id" column="region_id" />
		<result property="org_id" column="org_id"/>
		<result property="data_month" column="data_month"/>
		<result property="bad_num" column="bad_num"/>
		<result property="bad_sum" column="bad_sum"/>
		<result property="bad_rate" column="bad_rate"/>
		<result property="yearly_plan_sum" column="yearly_plan_sum"/>
		<result property="yearly_plan_micro_sum" column="yearly_plan_micro_sum"/>
		<result property="createtime" column="createtime"/>
		<result property="creatorid" column="creatorid"/>
		<result property="updatetime" column="updatetime"/>
		<result property="updatorid" column="updatorid"/>
<!-- 		<result property="lastupdate" column="lastupdate"/> -->
	</resultMap>
	
	<!-- 根据组织id和当月月份  获取dataRefresh -->
	<select id="getDataRefresh" parameterType="java.util.Map" resultMap="dataRefresh" flushCache="true" useCache="true">
	
		select * from tb_data_refresh where org_id = #{org_id} and data_month=#{data_month}
		
	</select>
	
	
	<!-- 插入	资料更新表 -->
	<insert id="insertDataRefresh" parameterType="com.dcits.govsbu.sd.taxbankplatform.statisticalanalysis.model.DataRefreshEntity">
		INSERT INTO `tb_data_refresh`
			(dr_id,region_id,org_id,data_month,bad_num,bad_sum,bad_rate,yearly_plan_sum,yearly_plan_micro_sum,createtime,creatorid,updatetime,updatorid) 
		VALUES 
			(#{id},#{region_id}, #{org_id},#{data_month}, #{bad_num}, #{bad_sum}, #{bad_rate}, #{yearly_plan_sum}, #{yearly_plan_micro_sum}, #{createtime}, #{creatorid}, #{updatetime}, #{updatorid});
	
	</insert>
	
	<!-- 更新	资料更新表 -->
	<update id="updateDataRefresh" parameterType="com.dcits.govsbu.sd.taxbankplatform.statisticalanalysis.model.DataRefreshEntity">
		update `tb_data_refresh`
	    <set>
	      <if test="bad_num != null and bad_num != ''">
	        bad_num = #{bad_num},
	      </if>
	      <if test="bad_sum != null and bad_sum != ''">
	        bad_sum = #{bad_sum},
	      </if>
	      <if test="bad_rate != null and bad_rate != ''">
	        bad_rate = #{bad_rate},
	      </if>
	      <if test="yearly_plan_sum != null and yearly_plan_sum != ''">
	        yearly_plan_sum = #{yearly_plan_sum},
	      </if>
	      <if test="yearly_plan_micro_sum != null and yearly_plan_micro_sum != ''">
	        yearly_plan_micro_sum = #{yearly_plan_micro_sum},
	      </if>
	      <if test="updatetime != null">
	        updatetime = #{updatetime},
	      </if>
	      <if test="updatorid != null and updatorid != ''">
	        updatorid = #{updatorid},
	      </if>
	    </set>
	    where dr_id = #{dr_id}
	
	</update>
	
		
	<!-- 获取所有银行总行（银行一级） -->
	<select id="getCoreBank" resultType="java.util.Map">
		SELECT 
			org.org_id,org.org_name,org.region_id 
		FROM 
			tb_organizations org
		LEFT JOIN tb_organizations_type ot ON ot.ot_id=org.ot_id 
		WHERE 
			org.enabled='Y' AND org.up_org_id IS NULL AND ot.ot_type_code='bank' AND ot.enabled='Y'
	
	</select>
	
	
	<!-- 根据银行组织id获取所有的用户 -->
	<select id="getBankAllUser" parameterType="String" resultType="java.util.Map">
		SELECT 
			ui.u_telephone phone,u.u_name
		FROM 
			tb_user u
		LEFT JOIN tb_user_info ui ON ui.u_id=u.u_id
		WHERE 
			u.org_id=#{org_id};
	</select>
</mapper>