<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dcits.govsbu.sd.taxbankplatform.regions.mapper.RegionsMapper">
	<!--mybatis ehcache缓存配置,以下两个<cache>标签二选一,第一个可以输出日志,第二个不输出日志 -->
	<cache type="org.mybatis.caches.ehcache.LoggingEhcache"/> 
	<!-- <cache type="org.mybatis.caches.ehcache.EhcacheCache"/> -->

	<sql id="regionsAttributes">
		region_id,
		region_name,
		region_code,
		tax_name,
		tax_id,
		enabled,
		currentlocation,
		remark,
		creatorid,
		createtime,
		updatorid,
		updatetime
	</sql>

	<resultMap id="regionsMap" type="com.dcits.govsbu.sd.taxbankplatform.regions.model.RegionsEntity">
		<id property="id" column="region_id"/>
		<result property="regionname" column="region_name"/>
		<result property="regioncode" column="region_code"/>
		<result property="taxname" column="tax_name"/>
		<result property="taxid" column="tax_id"/>
		<result property="enabled" column="enabled"/>
		<result property="currentlocation" column="currentlocation"/>
		<result property="remark" column="remark"/>
		<result property="creatorid" column="creatorid"/>
		<result property="createtime" column="createtime"/>
		<result property="updatorid" column="updatorid"/>
		<result property="updatetime" column="updatetime"/>
	</resultMap>
	
	<select id="queryListByPage" parameterType="map" resultMap="regionsMap" flushCache="true" useCache="true">
		<!-- 
			偏移offset较小的时候，直接使用limit较优；
			偏移offset较大的时候，使用下面子查询的方式较优；
			具体可以根据业务情况选择 
		-->
		<!-- 
		select <include refid="userAttributes" /> from tb_user Where u_id >=(
		select u_id from tb_user order by u_id limit ${start},1
		) limit ${pageNumber}
		 -->
		SELECT <include refid="regionsAttributes" /> FROM tb_regions
		<where>
			<if test="regionname != null and regionname != ''">
				region_name like CONCAT('%',#{regionname},'%')
			</if>
		</where>
	</select>
	
	<select id="findById" parameterType="String" resultMap="regionsMap" flushCache="true" useCache="true">
		select 
	    <include refid="regionsAttributes" />
	    from tb_regions
	    where region_id = #{id} 
	</select>
	
	<select id="queryListAll" parameterType="map" resultMap="regionsMap" flushCache="true" useCache="true" >
		select <include refid="regionsAttributes" /> from tb_regions  
		<where>
			enabled='Y'
			<if test="regionid != null and regionid != ''">
				and region_id= #{regionid}
			</if>
		</where>
		ORDER BY region_id
	</select>
	
	<select id="findByRegioncode" parameterType="String" resultMap="regionsMap" flushCache="true" useCache="true">
		select <include refid="regionsAttributes" /> from tb_regions where FIND_IN_SET(region_code,#{regioncode});
	</select>
	
	
	<select id="findByName" parameterType="String" resultMap="regionsMap" flushCache="true" useCache="true">
		select <include refid="regionsAttributes" /> from tb_regions where region_name=#{name}
	</select>
	
	<insert id="insert" parameterType="com.dcits.govsbu.sd.taxbankplatform.regions.model.RegionsEntity">
		insert into tb_regions (
				region_id,
				region_name,
				region_code,
				tax_name,
				tax_id,
				enabled,
				currentlocation,
				remark,
				creatorid,
				createtime,
				updatorid,
				updatetime
			)   
		values (
				#{id},
				#{regionname},
				#{regioncode},
				#{taxname},
				#{taxid},
				#{enabled},
				#{currentlocation},
				#{remark},
				#{creatorid},
				#{createtime},
				#{updatorid},
				#{updatetime}
			)  
	</insert>
	
	<update id="update" parameterType="com.dcits.govsbu.sd.taxbankplatform.regions.model.RegionsEntity" flushCache="true">
		update tb_regions
	    <set >
 	      <if test="regionname != null" > 
 	        region_name = #{regionname}, 
	      </if> 
	      <if test="regioncode != null" >
	        region_code = #{regioncode},
	      </if>
	      <if test="taxname != null" >
	        tax_name = #{taxname},
	      </if>
	      <if test="taxid != null" >
	        tax_id = #{taxid},
	      </if>
	      <if test="enabled != null" >
	        enabled = #{enabled},
	      </if>
	      <if test="currentlocation != null" >
	        currentlocation = #{currentlocation},
	      </if>
	       <if test="remark != null" >
	        remark = #{remark},
	      </if>
	      <if test="creatorid != null" >
	        creatorid = #{creatorid},
	      </if>
	      <if test="createtime != null" >
	        createtime = #{createtime},
	      </if>
	      <if test="updatorid != null" >
	        updatorid = #{updatorid},
	      </if>
	      <if test="updatetime != null" >
	        updatetime =  now()
	      </if>
	    </set>
	    where region_id = #{id}
	</update>
	
	<delete id="deleteBatchById" parameterType="list">
		<![CDATA[  
       delete from tb_regions where region_id in  
    	]]>  
	    <foreach collection="list" item = "id" open="(" separator="," close=")">
	    #{id}  
	    </foreach>  
	</delete>
	
	<!-- <update id="deleteById" parameterType="com.dcits.govsbu.sd.taxbankplatform.regions.model.RegionsEntity" flushCache="true">
		update tb_regions set enabled = 'Y' where region_id = #{id}
	</update> -->
	
</mapper>