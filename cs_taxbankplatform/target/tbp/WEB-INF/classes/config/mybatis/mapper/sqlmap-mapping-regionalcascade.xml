<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dcits.govsbu.sd.taxbankplatform.regionalcascade.mapper.CascadeMapper">
	<!--mybatis ehcache缓存配置,以下两个<cache>标签二选一,第一个可以输出日志,第二个不输出日志 -->
	<cache type="org.mybatis.caches.ehcache.LoggingEhcache"/> 
	
	<resultMap id="provinceListMap" type="com.dcits.govsbu.sd.taxbankplatform.provincecities.model.ProvinceCitiesEntity">
		<id property="id" column="pc_id"/>
		<result property="pcpid" column="pc_pid" />
		<result property="pccode" column="pc_code" />
		<result property="pcname" column="pc_name" />
	</resultMap>
	<resultMap id="userPccodeMap" type="com.dcits.govsbu.sd.taxbankplatform.regionalcascade.model.CascadeEntity">
		<id property="uId" column="u_id"/>
		<result property="uName" column="u_Name" />
		<result property="name" column="name" />
		<result property="pcId" column="pcid" />
		<result property="pcpId" column="pcpid" />
		<result property="fname" column="fname" />
		<result property="fpcId" column="fpcid" />
		<result property="fpcpId" column="fpcpid" />
		<result property="ffname" column="ffname" />
		<result property="ffpcId" column="ffpcid" />
		<result property="ffpcpId" column="ffpcpid" />
	</resultMap>

	<!-- 查询所有市级 -->
	<select id="querycityListAll" parameterType="String" resultMap="provinceListMap" flushCache="true" useCache="true">
		select pc_id,pc_name,pc_pid,pc_code from tb_province_cities 
		where  pc_pid=#{pcId}
	</select>
	
	<!-- 查询所有区级 -->
	<select id="queryareaListAll" parameterType="String" resultMap="provinceListMap" flushCache="true" useCache="true">
		select tb.pc_id,tb.pc_pid,tb.pc_code,tb.pc_name from tb_province_cities tb1
		join tb_province_cities tb on tb1.pc_id=tb.pc_pid where tb1.pc_pid!=0 and tb.pc_pid=#{pcId}
	</select>
	
	<select id="queryareaBycity" parameterType="String" resultMap="provinceListMap" flushCache="true" useCache="true">
		select tb.pc_id,tb.pc_pid,tb.pc_code,tb.pc_name from tb_province_cities tb1
		join tb_province_cities tb on tb1.pc_id=tb.pc_pid where tb1.pc_pid!=0 and
		 tb.pc_pid in (select pc_id from tb_province_cities where pc_pid=#{pcId} )
	</select>
	<!-- 查询用户所属地区-->
	<select id="queryUserArea" parameterType="String" resultMap="userPccodeMap" flushCache="true" useCache="true">
		 select a.u_id,a.u_name,
		 		case when c.pc_id=0 then null else c.pc_name end name,c.pc_id pcid,c.pc_pid pcpid,
			   case when d.pc_id=0 then null else d.pc_name end fname,d.pc_id fpcid,d.pc_pid fpcpid,
		 	   case when e.pc_id=0 then null else e.pc_name end ffname,e.pc_id ffpcid,e.pc_pid ffpcpid
		  from tb_user a,
		       tb_regions b,
		       tb_province_cities c,
		       tb_province_cities d,
		       tb_province_cities e
		 where a.u_id=#{userId} and a.region_id = b.region_id and b.region_code=c.pc_code
		 		and c.pc_pid=d.pc_id and d.pc_pid=e.pc_id
	</select>
</mapper>