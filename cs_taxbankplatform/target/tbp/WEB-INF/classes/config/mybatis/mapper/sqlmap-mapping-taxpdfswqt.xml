<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.dcits.govsbu.sd.taxbankplatform.taxpdf.mapper.TaxPdfSwqtMapper" >
<cache type="org.mybatis.caches.ehcache.LoggingEhcache"/> 
  <resultMap id="BaseResultMap" type="com.dcits.govsbu.sd.taxbankplatform.taxpdf.model.TaxPdfSwqtEntity" >
    <result property="qymc" column="nsryhxx_qymc"/>
    <result property="nsrsbh" column="tth_nsrsbh"/>
    <collection property="taxSwqtListEntity" ofType="com.dcits.govsbu.sd.taxbankplatform.taxpdf.model.TaxSwqtListEntity">
			<!--企业税务变更记录 -->
			<association property="taxQybgxxEntity" column="id" javaType="com.dcits.govsbu.sd.taxbankplatform.qybgxx.model.TaxQybgxxEntity">
				<id column="tthb_id" property="id" />
				<result property="tthbBgxmDm" column="tthb_bgxm_dm"/>
				<result property="tthbBgqnr" column="tthb_bgqnr"/>
				<result property="tthbBghnr" column="tthb_bghnr"/>
				<result property="tthbXgrq" column="tthb_xgrq"/>
			</association>
			<!-- 违法违章信息 -->
			<association property="taxSswfxwdjEntity" column="id" javaType="com.dcits.govsbu.sd.taxbankplatform.sswfxwdj.model.TaxSswfxwdjEntity">
				<id column="tts_id" property="id" />
				<result property="ttsDjrq" column="tts_djrq"/>
				<result property="ttsWfsx" column="tts_wfsx"/>
				<result property="ttsSswflxDm" column="tts_sswflx_dm"/>
				<result property="ttsSswfxwclztDm" column="tts_sswfxwclzt_dm"/>
				<result property="ttsWfsx" column="tts_wfsx"/>
			</association>
		</collection>
		<!-- 欠税信息 -->
		<collection property="qsxxEntity" ofType="com.dcits.govsbu.sd.taxbankplatform.taxpdf.model.QsxxEntity">
			<!-- <result column="tpq_id" property="id"  />
		    <result column="tpq_xm_dm" property="tpqXmDm"  />
		    <result column="tpq_gsse" property="tpqGsse"  />
		    <result column="tpq_dsse" property="tpqDsse"  />
		    <result column="tpq_total" property="tpqTotal"  />
		    <result column="created_id" property="createdId"  /> -->
		    <result column="zsxmmc" property="zsxmmc" />
		    <result column="ybse" property="ybse" />
		</collection>
  </resultMap>
  <!-- 税务其他信息 -->
	<select id="findByDjxh" parameterType="map" resultMap="BaseResultMap" flushCache="true" useCache="true">
		SELECT 
		tty.tth_nsrsbh,
		tnx.nsryhxx_qymc,
		ttq.tthb_bgxm_dm,
		ttq.tthb_bgqnr,
		ttq.tthb_bghnr,
		ttq.tthb_xgrq,
		tts.tts_djrq,
		tts.tts_wfsx,
		tts.tts_sswflx_dm,
		tts.tts_sswfxwclzt_dm, 
		tts.tts_wfsx
		FROM tb_nsryhxx tnx
		LEFT JOIN t_tax_qybgxx ttq ON tnx.nsryhxx_djxh = ttq.djxh 
		LEFT JOIN t_tax_sswfxwdj tts ON ttq.djxh = tts.djxh
		AND ttq.sqxh = tts.sqxh
		LEFT JOIN t_tax_qyjcxx tty ON tts.djxh = tty.djxh
		AND tts.sqxh = tty.sqxh
	where tnx.creatorid = #{userid} AND tty.sqxh = #{sqxh}
	</select >
	<select id="findQsxx" parameterType="String" resultMap="BaseResultMap" flushCache="true" useCache="true">
		<!--SELECT tpq_id,tpq_xm_dm,tpq_gsse,tpq_dsse,tpq_total FROM  t_tax_pdf_qsxx -->
		SELECT td.zsxmmc as zsxmmc, SUM(tq.ttq_ybse) as ybse
		FROM t_tax_qsclxx tq
		JOIN t_dm_gy_zsxm td ON tq.ttq_zsxm_dm = td.zsxm_dm
		WHERE ttq_skssqq BETWEEN DATE_SUB(DATE(NOW()), INTERVAL 2 YEAR) AND DATE(NOW())
		AND tq.sqxh = #{sqxh};
	</select>
</mapper>