<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dcits.govsbu.sd.taxbankplatform.financialProducts.mapper.FinancialProductsMapper">
	<!--mybatis ehcache缓存配置,以下两个<cache>标签二选一,第一个可以输出日志,第二个不输出日志 -->
	<cache type="org.mybatis.caches.ehcache.LoggingEhcache"/> 
	<resultMap id="financialProductsMap" type="com.dcits.govsbu.sd.taxbankplatform.financialProducts.model.FinancialProductsEntity" >
		<id property="id" column="id"/>
		<result property="yhmc" column="yhmc"/>
		<result property="yhdm" column="yhdm"/>
		<result property="cpmc" column="cpmc"/>
		<result property="cpdm" column="cpdm"/>
		<result property="orgId" column="orgId"/>
	</resultMap>
	
	<!-- 插入数据  3.0v 增加bankaccount password字段  modify by Sigua.Huang 2018/06/19-->
	<!-- <insert id="insert" parameterType="com.dcits.govsbu.sd.taxbankplatform.portmager.model.PortmagerEntity">
		insert into tb_bank_port_manage (
			id,
			yhmc,
			xlzt,
			yhdm,
			zxyys,
			zxbh,
			yhdkh,
			yhzxlldz,
			yhfwqipdz,
			sjdkh,
			sjzxlldz,
			sjfwqipdz,
			bankaccount,
			password,
			bz,
			cjr,
			createtime,
			updatetime
			)   
		values (
			#{id},
			#{yhmc},
			'xlzt01',
			#{yhdm},
			#{zxyys},
			#{zxbh},
			#{yhdkh},
			#{yhzxlldz},
			#{yhfwqipdz},
			#{sjdkh},
			#{sjzxlldz},
			#{sjfwqipdz},
			#{bankaccount},
			#{password},
			#{bz},
			#{cjr},
			now(),
			now()
			)  
	</insert> -->
	
	<!-- 搜索数据 -->
	<select id="queryListByPage" parameterType="map" resultMap="financialProductsMap" flushCache="true" useCache="true">
		SELECT
		    tf.fp_id as id,
		    org.org_name as yhmc,
		    org.org_id as orgId,
		    org.org_code as yhdm,
		    tf.fp_name as cpmc,
		    tf.fp_id as cpdm
		FROM tb_financial_product tf, tb_organizations org
		<where>
		org.org_id = tf.org_id
		<if test="searchKey != null and searchKey != ''">
			and  yhmc LIKE CONCAT('%','${searchKey}','%' )
		</if>
		</where>
	</select>
	
	<!-- 点击编辑按钮时候查询单条数据  3.0v 增加password字段  modify by Sigua.Huang 2018/06/19 -->
	<!-- <select id="findById" parameterType="String" resultMap="regionclassMap" flushCache="true" useCache="true">
		SELECT
			id,
			yhmc,
			xlzt,
			yhdm,
			zxyys,
			zxbh,
			yhdkh,
			yhzxlldz,
			yhfwqipdz,
			sjdkh,
			sjzxlldz,
			sjfwqipdz,
			password,
			bz,
			cjr,
			createtime,
			updatetime
		FROM tb_bank_port_manage
		where id = #{id}
	</select>
	
	更新数据
	<update id="update" parameterType="java.util.Map" flushCache="true">
		update tb_bank_port_manage set 
		<if test="xlzt != null and xlzt != ''">
				xlzt = #{xlzt},
		</if>
		updatetime = now()
		where id in
	<foreach collection="bankCodelist" item="bankCode" index="index" open="(" close=")" separator=",">
            #{bankCode}
    </foreach>
	</update>
	
    更新数据
	<update id="updateRecord" parameterType="com.dcits.govsbu.sd.taxbankplatform.portmager.model.PortmagerEntity" flushCache="true">
		update tb_bank_port_manage set 
		<if test="yhmc != null and yhmc != ''">
				yhmc = #{yhmc},
		</if>
		<if test="xlzt != null and xlzt != ''">
				xlzt = #{xlzt},
		</if>
				<if test="yhdm != null and yhdm != ''">
				yhdm = #{yhdm},
		</if>
		<if test="zxyys != null and zxyys != ''">
				zxyys = #{zxyys},
		</if>
		<if test="zxbh != null and zxbh != ''">
				zxbh = #{zxbh},
		</if>
		<if test="yhdkh != null and yhdkh != ''">
				yhdkh = #{yhdkh},
		</if>
		<if test="yhzxlldz != null and yhzxlldz != ''">
				yhzxlldz = #{yhzxlldz},
		</if>
		<if test="yhfwqipdz != null and yhfwqipdz != ''">
				yhfwqipdz = #{yhfwqipdz},
		</if>
		<if test="sjdkh != null and sjdkh != ''">
				sjdkh = #{sjdkh},
		</if>
		<if test="sjzxlldz != null and sjzxlldz != ''">
				sjzxlldz = #{sjzxlldz},
		</if>
		<if test="sjfwqipdz != null and sjfwqipdz != ''">
				sjfwqipdz = #{sjfwqipdz},
		</if>
		<if test="bz != null and bz != ''">
				bz = #{bz},
		</if>
		
		updatetime = now()
		where id = #{id}
	</update>
	
	获取组织列表
	<select id="findOrgNameList" parameterType="String" resultType="com.dcits.govsbu.sd.taxbankplatform.organization.model.OrganizationEntity" flushCache="true" useCache="true">
		select * from tb_organizations where ot_id = 'ZZLX002' and region_id = #{regionId};
	</select>
	
		获取选取组织对应的组织编码
	<select id="findOrgCodeByOrgName" parameterType="String" resultType="String" flushCache="true" useCache="true">
		select org_code from tb_organizations where org_name = #{rgName};
	</select>
	
		获取银行端口接入管理线路状态码表列表
	<select id="findXlztList" resultType="com.dcits.govsbu.sd.taxbankplatform.portmager.model.XlztEntity" flushCache="true" useCache="true">
		select * from dm_xlzt;
	</select>
	
		新增银行端口时判断银行是否存在
	<select id="findByYhmc" parameterType="String" resultMap="regionclassMap" flushCache="true" useCache="true">
		SELECT
			id,
			yhmc,
			xlzt,
			yhdm,
			zxyys,
			zxbh,
			yhdkh,
			yhzxlldz,
			yhfwqipdz,
			sjdkh,
			sjzxlldz,
			sjfwqipdz,
			bz,
			cjr,
			createtime,
			updatetime
		FROM tb_bank_port_manage
		WHERE yhmc = #{yhmc} and xlzt = 'xlzt02' ORDER BY createtime DESC
	</select> -->
		<!-- 插入组织表 -->
		<insert id="insertOrganizations" parameterType="map" useGeneratedKeys="true" keyProperty="id">
		insert ignore into tb_organizations (
				org_id,
				region_id,
				org_name,
				ot_id,
				org_code,
				org_logo_url,
				remark,
				enabled,
				creatorid,
				createtime,
				updatorid,
				updatetime,
				up_org_id,
				rc_id,
				rzc_id,
				sqc_id,
				accredit,
				pc_id
			)   
		values (
				#{orgId},
				"KTQY0012017101218515465102",
				#{orgname},
				"ZZLX002",
				#{orgcode},
				"0",
				"0",
				"Y",
				"0",
				now(),
				"0",
				now(),
				"0",
				"0",
				"0",
				"0",
				"0",
				"0"
			)  
	</insert>
	<!-- 更新组织表 -->
	<update id="updateOrganizations" parameterType="map" flushCache="true">
		update tb_organizations
	    <set >
	      <if test="orgname != null" >
	        org_name = #{orgname},
	      </if>
	      <if test="orgcode != null" >
	        org_code = #{orgcode},
	      </if>
	    </set>
	    where org_id = #{orgId}
	</update>
	<!-- 插入产品表 -->
	<insert id="insertFinancialProduct" parameterType="map">
    insert into tb_financial_product (fp_id, fp_name, org_id, 
      region_id, fp_issue_time, fp_remove_time,fp_many_credit, 
      la_id, ld_id, lr_id, 
      rw_ids,gs_ids, ps_id, fp_overlay_pc_ids, 
      fp_ishot, fp_need_info, fp_prd_img_url, 
      fp_remark, creatorid, 
      createtime, updatorid, updatetime, 
      fp_details,pt_dm)
    values (
			#{id},
			#{cpmc}, 
			#{orgId}, 
			"0", 
			now(),
			now(),
			"0",
			"0", 
			"0", 
			"0",
			"0",
			"0",
			"0",
			"0", 
			"0",
			"0", 
			"0", 
			"0",
			"0", 
			 now(),
			"0",
			 now(), 
			"0",
			"0")
  </insert>
  
    <!-- 修改产品表 -->
   <update id="updateFinancialProduct" parameterType="map" flushCache="true">
  	update tb_financial_product
    <set>
      <if test="fpName != null and fpName !=''">
        fp_name = #{cpmc},
      </if>
      <if test="orgId != null and orgId != ''">
        org_id = #{orgId},
      </if>
       <if test="cpdm != null and cpdm != ''">
        fp_id = #{cpdm},
      </if>
    </set>
    where fp_id = #{id}
  </update>
  	<!-- 编辑时反写出该条记录的数据 -->
   	<select id="findByCpDm" parameterType="String" resultMap="financialProductsMap" flushCache="true" useCache="true">
		SELECT
		    org.org_id as id,
		    org.org_name as yhmc,
		     org.org_id as orgId,
		    org.org_code as yhdm,
		    tf.fp_name as cpmc,
		    tf.fp_id as cpdm
		FROM tb_financial_product tf, tb_organizations org
		where org.org_id = tf.org_id and tf.fp_id = #{cpdm}
  </select>
	
</mapper>