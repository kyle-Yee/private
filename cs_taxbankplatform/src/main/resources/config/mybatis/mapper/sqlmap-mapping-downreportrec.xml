<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dcits.govsbu.sd.taxbankplatform.downreport.mapper.DownloadsReportRecMapper" >
  <resultMap id="BaseResultMap" type="com.dcits.govsbu.sd.taxbankplatform.downreport.model.DownloadsReportRecEntity" >
    <id column="drr_id" property="id" jdbcType="INTEGER" />
    <result column="down_name" property="downName" jdbcType="VARCHAR" />
    <result column="enterprise_name" property="enterpriseName" jdbcType="VARCHAR" />
    <result column="down_status" property="downStatus" jdbcType="VARCHAR" />
    <result column="down_time" property="downTime"/>
    <result column="report_url" property="reportUrl" jdbcType="VARCHAR" />
    <result column="la_id" property="laid" jdbcType="INTEGER"/>
    <result column="las_id" property="lasid" jdbcType="INTEGER"/>
  </resultMap>
  <sql id="Base_Column_List" >
    drr_id, down_name, enterprise_name, down_status, down_time,report_url,la_id,las_id
  </sql>
  <select id="findDownloadsReportRecById" resultMap="BaseResultMap" parameterType="String" >
    select 
     rec.drr_id, rec.down_name, rec.enterprise_name, rec.down_status, rec.down_time,rec.report_url,rec.la_id,rec.las_id
    from tb_downloads_report_rec rec
    LEFT JOIN tb_loan_apply app ON app.la_id=rec.la_id
    where app.la_id = #{id}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="String" >
    delete from tb_downloads_report_rec
    where drr_id = #{id}
  </delete>
  <insert id="insert" parameterType="com.dcits.govsbu.sd.taxbankplatform.downreport.model.DownloadsReportRecEntity" >
    insert into tb_downloads_report_rec (org_id,region_id,drr_id, down_name, enterprise_name, 
      down_status,la_id,las_id, down_time,report_url)
    values (#{orgId}, #{regionId},#{id}, #{downName},#{enterpriseName}, 
      #{downStatus},#{laid},#{lasid}, date_format(now(), '%Y-%m-%d %H:%i:%s'),#{reportUrl})
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.dcits.govsbu.sd.taxbankplatform.downreport.model.DownloadsReportRecEntity" >
    update tb_downloads_report_rec
    set down_name = #{downName},
      enterprise_name = #{enterpriseName},
      down_status = #{downStatus},
      down_time = #{downTime},
      report_url = #{reportUrl}
    where drr_id = #{id}
  </update>
    <select id="findBylaid" resultType="String" parameterType="String" >
    select   rec.down_time from tb_downloads_report_rec rec where rec.down_status=2
     and rec.la_id=#{laId}  group by rec.drr_id desc  limit 1
  </select>
  <select id="findBylaid2" resultMap="BaseResultMap" parameterType="String" >
    select 
    <include refid="Base_Column_List" />
    from 
		tb_downloads_report_rec rec 
	where rec.la_id=#{laId}  
	group by rec.drr_id desc  limit 1
  </select>
</mapper>