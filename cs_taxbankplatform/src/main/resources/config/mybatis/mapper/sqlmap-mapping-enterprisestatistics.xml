<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dcits.govsbu.sd.taxbankplatform.regulatorstatistics.mapper.EnterprisestatisticsMapper">
	<!--mybatis ehcache缓存配置,以下两个<cache>标签二选一,第一个可以输出日志,第二个不输出日志  -->
	<cache type="org.mybatis.caches.ehcache.LoggingEhcache"/> 
	
	<resultMap id="enterprisestatisticsMap" type="com.dcits.govsbu.sd.taxbankplatform.regulatorstatistics.model.EnterpriseInfoEntity">
		<result property="zcsj" column="zcsj" />
		<result property="qymc" column="qymc" />
		<result property="cr_sqdid" column="cr_sqdid" />
		<result property="frxm" column="frxm" />
		<result property="frsjh" column="frsjh" />
		<result property="sfrz" column="sfrz" />
		<result property="yy" column="yy" />
		<result property="regPhone" column="regPhone" />
		<result property="userName" column="userName" />
	</resultMap>
	<resultMap id="recordMap" type="com.dcits.govsbu.sd.taxbankplatform.regulatorstatistics.model.EnterpriseInfoEntity">
		<result property="cr_id" column="cr_id" />
		<result property="cr_qymc" column="cr_qymc" />
		<result property="cr_sqdid" column="cr_sqdid" />
		<result property="cr_nsrsbh" column="cr_nsrsbh" />
		<result property="cr_frsjh" column="cr_frsjh" />
		<result property="cr_zjlx" column="cr_zjlx" />
		<result property="cr_zjhm" column="cr_zjhm" />
		<result property="cr_sqsj" column="cr_sqsj" />
		<result property="cr_rzsj" column="cr_rzsj" />
		<result property="cr_shjg" column="cr_shjg" />
		<result property="cr_dbqk" column="cr_dbqk" />
		<result property="creatorid" column="creatorid" />
	</resultMap>
	<select id="enterprisestatistics" parameterType="map" resultMap="enterprisestatisticsMap" flushCache="true" useCache="true">
		select nx.createtime zcsj,nx.nsryhxx_qymc qymc,nx.nsryhxx_frmc frxm,nx.nsryhxx_frsjh frsjh,cr.cr_shjg sfrz,
		cr.cr_dbqk yy,nx.nsryhxx_zcsjh regPhone,n.nsryh_name userName
		from tb_nsryhxx nx
		join tb_nsryh n on n.nsryhxx_id=nx.nsryhxx_id
		<if test="province !=null and city==null and area==null and isAuth==null">
		left join (select *
						 from 
							(select tb_check_record.cr_id,tb_check_record.cr_qymc,
									tb_check_record.cr_nsrsbh,tb_check_record.cr_frsjh,
									tb_check_record.cr_zjlx,tb_check_record.cr_zjhm,
									tb_check_record.cr_rzsj,
									tb_check_record.cr_shjg,tb_check_record.cr_dbqk
							from tb_check_record
							order by tb_check_record.cr_rzsj desc) temp
						group by cr_nsrsbh
						order by cr_nsrsbh asc) cr on nx.nsryhxx_nsrsbh=cr.cr_nsrsbh or nx.nsryhxx_shtyxydm =cr.cr_nsrsbh
						 <!-- join tb_province_cities pc on
						join tb_province_cities pc on SUBSTR(pc.pc_code,1,6)=SUBSTR(nx.nsryhxx_swjgdm,2,6) -->
			<!-- left join tb_regions tr on n.region_id = tr.region_id 
			where tr.region_code in(select pc.pc_code from tb_province_cities pc where pc.pc_id = #{province}
			or pc.pc_pid = #{province} or pc.pc_pid in (select pcs.pc_id from tb_province_cities pcs where pcs.pc_pid = #{province }))		 -->
			where substring(nx.nsryhxx_swjgdm,2,2) in(select substring(pc.pc_code,1,2) from  tb_province_cities pc where pc.pc_id = #{province})
		</if>
		<if test="province !=null and city==null and area==null and isAuth ==1">
			join (select *
						 from 
							(select tb_check_record.cr_id,tb_check_record.cr_qymc,
									tb_check_record.cr_nsrsbh,tb_check_record.cr_frsjh,
									tb_check_record.cr_zjlx,tb_check_record.cr_zjhm,
									tb_check_record.cr_rzsj,
									tb_check_record.cr_shjg,tb_check_record.cr_dbqk
							from tb_check_record
							order by tb_check_record.cr_rzsj desc) temp
						group by cr_nsrsbh
						order by cr_nsrsbh asc) cr on nx.nsryhxx_nsrsbh=cr.cr_nsrsbh or nx.nsryhxx_shtyxydm =cr.cr_nsrsbh
			<!-- left join tb_regions tr on n.region_id = tr.region_id 
			where tr.region_code in(select pc.pc_code from tb_province_cities pc where pc.pc_id = #{province}
			or pc.pc_pid = #{province} or pc.pc_pid in (select pcs.pc_id from tb_province_cities pcs where pcs.pc_pid = #{province })) -->
			where substring(nx.nsryhxx_swjgdm,2,2) in(select substring(pc.pc_code,1,2) from  tb_province_cities pc where pc.pc_id = #{province})
			and nx.nsryhxx_swjgdm!=''
			and n.enabled='Y'
			<!-- where exists (select 1 from tb_province_cities pc where
			SUBSTR(pc.pc_code,1,2)=SUBSTR(nx.nsryhxx_swjgdm,2,2)
			and (pc.pc_id = #{pcId } or pc.pc_pid = #{pcId }
			or pc.pc_pid in (select pcs.pc_id from tb_province_cities pcs where pcs.pc_pid = #{pcId } ))) -->
		</if>
		<if test="province !=null and province !='' and city!=null and area==null and isAuth==null" >
			<if test="isChongQing != null and isChongQing == 'yes'">
				left join (select *
						 from 
							(select tb_check_record.cr_id,tb_check_record.cr_qymc,
									tb_check_record.cr_nsrsbh,tb_check_record.cr_frsjh,
									tb_check_record.cr_zjlx,tb_check_record.cr_zjhm,
									tb_check_record.cr_rzsj,
									tb_check_record.cr_shjg,tb_check_record.cr_dbqk
							from tb_check_record
							order by tb_check_record.cr_rzsj desc) temp
						group by cr_nsrsbh
						order by cr_nsrsbh asc) cr on nx.nsryhxx_nsrsbh=cr.cr_nsrsbh or nx.nsryhxx_shtyxydm =cr.cr_nsrsbh
						 <!-- join tb_province_cities pc on
						join tb_province_cities pc on SUBSTR(pc.pc_code,1,6)=SUBSTR(nx.nsryhxx_swjgdm,2,6) -->
			<!-- left join tb_regions tr on n.region_id = tr.region_id 
			where tr.region_code in(select pc.pc_code from tb_province_cities pc where pc.pc_id = #{city}
			or pc.pc_pid = #{city} or pc.pc_pid in (select pcs.pc_id from tb_province_cities pcs where pcs.pc_pid = #{city })) -->
			where substring(nx.nsryhxx_swjgdm,2,6) in(select substring(pc.pc_code,1,6) from  tb_province_cities pc where pc.pc_id = #{city})
				
				
				<!-- where exists (select 1 from tb_province_cities pc
				where SUBSTR(pc.pc_code,1,6)=SUBSTR(nx.nsryhxx_swjgdm,2,6)
				and (pc.pc_id = #{pcId } or pc.pc_pid = #{pcId }
				or pc.pc_pid in (select pcs.pc_id from tb_province_cities pcs where pcs.pc_pid = #{pcId } ))) -->
            </if>
            <if test="isChongQing != null and isChongQing == 'no'">
            	left join (select *
						 from 
							(select tb_check_record.cr_id,tb_check_record.cr_qymc,
									tb_check_record.cr_nsrsbh,tb_check_record.cr_frsjh,
									tb_check_record.cr_zjlx,tb_check_record.cr_zjhm,
									tb_check_record.cr_rzsj,
									tb_check_record.cr_shjg,tb_check_record.cr_dbqk
							from tb_check_record
							order by tb_check_record.cr_rzsj desc) temp
						group by cr_nsrsbh
						order by cr_nsrsbh asc) cr on nx.nsryhxx_nsrsbh=cr.cr_nsrsbh or nx.nsryhxx_shtyxydm =cr.cr_nsrsbh
						 <!-- join tb_province_cities pc on
						join tb_province_cities pc on SUBSTR(pc.pc_code,1,6)=SUBSTR(nx.nsryhxx_swjgdm,2,6) -->
			<!-- left join tb_regions tr on n.region_id = tr.region_id 
			where tr.region_code in(select pc.pc_code from tb_province_cities pc where pc.pc_id = #{city}
			or pc.pc_pid = #{city} or pc.pc_pid in (select pcs.pc_id from tb_province_cities pcs where pcs.pc_pid = #{city })) -->
            where substring(nx.nsryhxx_swjgdm,2,4) in(select substring(pc.pc_code,1,4) from  tb_province_cities pc where pc.pc_id = #{city})
            	
            
            	<!-- where exists (select 1 from tb_province_cities pc
            	where SUBSTR(pc.pc_code,1,4)=SUBSTR(nx.nsryhxx_swjgdm,2,4)
            	and (pc.pc_id = #{pcId } or pc.pc_pid = #{pcId }
				or pc.pc_pid in (select pcs.pc_id from tb_province_cities pcs where pcs.pc_pid = #{pcId } ))) -->
            </if>
		</if>
		
		<if test="province !=null and province !='' and city!=null and area==null and isAuth==1" >
			<if test="isChongQing != null and isChongQing == 'yes'">
				join (select *
						 from 
							(select tb_check_record.cr_id,tb_check_record.cr_qymc,
									tb_check_record.cr_nsrsbh,tb_check_record.cr_frsjh,
									tb_check_record.cr_zjlx,tb_check_record.cr_zjhm,
									tb_check_record.cr_rzsj,
									tb_check_record.cr_shjg,tb_check_record.cr_dbqk
							from tb_check_record
							order by tb_check_record.cr_rzsj desc) temp
						group by cr_nsrsbh
			order by cr_nsrsbh asc) cr on nx.nsryhxx_nsrsbh=cr.cr_nsrsbh or nx.nsryhxx_shtyxydm =cr.cr_nsrsbh
			<!--left join tb_regions tr on n.region_id = tr.region_id 
			where tr.region_code in(select pc.pc_code from tb_province_cities pc where pc.pc_id = #{city}
			or pc.pc_pid = #{city} or pc.pc_pid in (select pcs.pc_id from tb_province_cities pcs where pcs.pc_pid = #{city })) -->
			where substring(nx.nsryhxx_swjgdm,2,6) in(select substring(pc.pc_code,1,6) from  tb_province_cities pc where pc.pc_id = #{city})
			and nx.nsryhxx_swjgdm!=''
			and n.enabled='Y'
						 <!-- join tb_province_cities pc on
						join tb_province_cities pc on SUBSTR(pc.pc_code,1,6)=SUBSTR(nx.nsryhxx_swjgdm,2,6) -->
			<!-- left join tb_regions tr on n.region_id = tr.region_id 
			where tr.region_code in(select pc.pc_code from tb_province_cities pc where pc.pc_id = #{city}
			or pc.pc_pid = #{city} or pc.pc_pid in (select pcs.pc_id from tb_province_cities pcs where pcs.pc_pid = #{city })) -->
				
				
				
				<!-- where exists (select 1 from tb_province_cities pc
				where SUBSTR(pc.pc_code,1,6)=SUBSTR(nx.nsryhxx_swjgdm,2,6)
				and (pc.pc_id = #{pcId } or pc.pc_pid = #{pcId }
				or pc.pc_pid in (select pcs.pc_id from tb_province_cities pcs where pcs.pc_pid = #{pcId } ))) -->
            </if>
            <if test="isChongQing != null and isChongQing == 'no'">
            	join (select *
						 from 
							(select tb_check_record.cr_id,tb_check_record.cr_qymc,
									tb_check_record.cr_nsrsbh,tb_check_record.cr_frsjh,
									tb_check_record.cr_zjlx,tb_check_record.cr_zjhm,
									tb_check_record.cr_rzsj,
									tb_check_record.cr_shjg,tb_check_record.cr_dbqk
							from tb_check_record
							order by tb_check_record.cr_rzsj desc) temp
						group by cr_nsrsbh
						order by cr_nsrsbh asc) cr on nx.nsryhxx_nsrsbh=cr.cr_nsrsbh or nx.nsryhxx_shtyxydm =cr.cr_nsrsbh
			<!-- left join tb_regions tr on n.region_id = tr.region_id 
			where tr.region_code in(select pc.pc_code from tb_province_cities pc where pc.pc_id = #{city}
			or pc.pc_pid = #{city} or pc.pc_pid in (select pcs.pc_id from tb_province_cities pcs where pcs.pc_pid = #{city })) -->
			where substring(nx.nsryhxx_swjgdm,2,4) in(select substring(pc.pc_code,1,4) from  tb_province_cities pc where pc.pc_id = #{city})
			and nx.nsryhxx_swjgdm!=''
			and n.enabled='Y'
            
            	
            
            	<!-- where exists (select 1 from tb_province_cities pc
            	where SUBSTR(pc.pc_code,1,4)=SUBSTR(nx.nsryhxx_swjgdm,2,4)
            	and (pc.pc_id = #{pcId } or pc.pc_pid = #{pcId }
				or pc.pc_pid in (select pcs.pc_id from tb_province_cities pcs where pcs.pc_pid = #{pcId } ))) -->
            </if>
		</if>
		
		<if test="area !=null and area !='' and isAuth==null">
			left join (select *
						 from 
							(select tb_check_record.cr_id,tb_check_record.cr_qymc,
									tb_check_record.cr_nsrsbh,tb_check_record.cr_frsjh,
									tb_check_record.cr_zjlx,tb_check_record.cr_zjhm,
									tb_check_record.cr_rzsj,
									tb_check_record.cr_shjg,tb_check_record.cr_dbqk
							from tb_check_record
							order by tb_check_record.cr_rzsj desc) temp
						group by cr_nsrsbh
						order by cr_nsrsbh asc) cr on nx.nsryhxx_nsrsbh=cr.cr_nsrsbh or nx.nsryhxx_shtyxydm =cr.cr_nsrsbh
						 <!-- join tb_province_cities pc on
						join tb_province_cities pc on SUBSTR(pc.pc_code,1,6)=SUBSTR(nx.nsryhxx_swjgdm,2,6) -->
			<!-- left join tb_regions tr on n.region_id = tr.region_id 
			where tr.region_code in(select pc.pc_code from tb_province_cities pc where pc.pc_id = #{city}
			or pc.pc_pid = #{city} or pc.pc_pid in (select pcs.pc_id from tb_province_cities pcs where pcs.pc_pid = #{city })) -->
			where substring(nx.nsryhxx_swjgdm,2,6) in(select substring(pc.pc_code,1,6) from  tb_province_cities pc where pc.pc_id = #{area})
		</if>
		<if test="area !=null and area !='' and isAuth==1">
			join (select *
						 from 
							(select tb_check_record.cr_id,tb_check_record.cr_qymc,
									tb_check_record.cr_nsrsbh,tb_check_record.cr_frsjh,
									tb_check_record.cr_zjlx,tb_check_record.cr_zjhm,
									tb_check_record.cr_rzsj,
									tb_check_record.cr_shjg,tb_check_record.cr_dbqk
							from tb_check_record
							order by tb_check_record.cr_rzsj desc) temp
						group by cr_nsrsbh
						order by cr_nsrsbh asc) cr on nx.nsryhxx_nsrsbh=cr.cr_nsrsbh or nx.nsryhxx_shtyxydm =cr.cr_nsrsbh
			<!-- left join tb_regions tr on n.region_id = tr.region_id 
			where tr.region_code in(select pc.pc_code from tb_province_cities pc where pc.pc_id = #{city}
			or pc.pc_pid = #{city} or pc.pc_pid in (select pcs.pc_id from tb_province_cities pcs where pcs.pc_pid = #{city })) -->
			where substring(nx.nsryhxx_swjgdm,2,6) in(select substring(pc.pc_code,6) from  tb_province_cities pc where pc.pc_id = #{area})
			and nx.nsryhxx_swjgdm!=''
			and n.enabled='Y'
		</if>
		<!-- where exists (select 1 from tb_province_cities pc where
		<if test="province !=null and city==null and area==null">
			SUBSTR(pc.pc_code,1,2)=SUBSTR(nx.nsryhxx_swjgdm,2,2)
		</if>
		<if test="province !=null and province !='' and city!=null and area==null" >
			<if test="isChongQing != null and isChongQing == 'yes'">
				SUBSTR(pc.pc_code,1,6)=SUBSTR(nx.nsryhxx_swjgdm,2,6)
            </if>
            <if test="isChongQing != null and isChongQing == 'no'">
            	SUBSTR(pc.pc_code,1,4)=SUBSTR(nx.nsryhxx_swjgdm,2,4)
            </if>
		</if>
		<if test="area !=null and area !='' ">
			SUBSTR(pc.pc_code,1,6)=SUBSTR(nx.nsryhxx_swjgdm,2,6)
		</if>
		and (pc.pc_id = #{pcId } or pc.pc_pid = #{pcId }
				or pc.pc_pid in (select pcs.pc_id from tb_province_cities pcs where pcs.pc_pid = #{pcId } )) -->
		<if test="qymc !=null and qymc !='' ">
			and  nx.nsryhxx_qymc like  CONCAT('%',#{qymc},'%')
		</if>
		<if test="frxm !=null and frxm !='' ">
			and  nx.nsryhxx_frmc like  CONCAT('%',#{frxm},'%')
		</if>
		<if test="frsjh !=null and frsjh !='' ">
			and  (nx.nsryhxx_frsjh like CONCAT('%','${frsjh}','%' ) or nx.nsryhxx_zcsjh like CONCAT('%','${frsjh}','%' ))
		</if>
		<if test="starttime !=null and starttime !='' and endtime !=null and endtime !='' ">
			<!-- and date_format(nx.createtime, '%Y-%c-%d') between date_format(#{starttime}, '%Y-%c-%d') 
			and date_format(#{endtime}, '%Y-%c-%d') -->
			and unix_timestamp(DATE_FORMAT(nx.createtime, '%Y-%m-%d')) between unix_timestamp(#{starttime}) and  unix_timestamp(#{endtime})
		</if>
		<!-- <where>
			<if test="pcId !=null and pcId !='' ">
				(pc.pc_id = #{pcId } or pc.pc_pid = #{pcId }
				or pc.pc_pid in (select pcs.pc_id from tb_province_cities pcs where pcs.pc_pid = #{pcId } ))
			</if>
			<if test="qymc !=null and qymc !='' ">
				 and  nx.nsryhxx_qymc like  CONCAT('%',#{qymc},'%')
			</if>
			<if test="frxm !=null and frxm !='' ">
				 and  nx.nsryhxx_frmc like  CONCAT('%',#{frxm},'%')
			</if>
			<if test="frsjh !=null and frsjh !='' ">
				 and  nx.nsryhxx_frsjh
				 like CONCAT('%','${frsjh}','%' ) 
			
			</if> 
			<if test="starttime !=null and starttime !='' and endtime !=null and endtime !='' ">
				and date_format(nx.createtime, '%Y-%c-%d') between date_format(#{starttime}, '%Y-%c-%d') 
				and date_format(#{endtime}, '%Y-%c-%d')
			</if>
		</where> -->
		group by nx.nsryhxx_id
		ORDER BY nx.createtime DESC
	</select>
	<select id="findcheckrecord" parameterType="map" resultMap="enterprisestatisticsMap" flushCache="true" useCache="true">
		   select record.cr_id crid,record.cr_qymc qymc,
									record.cr_nsrsbh nsrsbh,record.cr_frsjh frsjh,
									record.cr_zjlx,record.cr_zjhm,
									record.cr_sqsj sqsj,record.cr_rzsj rzsj,
									record.cr_shjg sfrz,record.cr_dbqk yy,
									xx.nsryhxx_nsrsbh,
									xx.nsryhxx_frmc frxm,
									xx.nsryhxx_zgswjdm,
									xx.nsryhxx_swjgdm swjgdm
							from (
							  SELECT tb_check_record.cr_id,tb_check_record.cr_qymc,
									tb_check_record.cr_nsrsbh,tb_check_record.cr_frsjh,
									tb_check_record.cr_zjlx,tb_check_record.cr_zjhm,
									tb_check_record.cr_sqsj,tb_check_record.cr_rzsj,
									tb_check_record.cr_shjg,tb_check_record.cr_dbqk FROM tb_check_record 
									 <if test="searchParam != null and searchParam != ''">
									 where
									 CONCAT(tb_check_record.cr_qymc, tb_check_record.cr_nsrsbh,tb_check_record.cr_frsjh) LIKE CONCAT('%',#{searchParam},'%')
									</if>
                       ORDER BY tb_check_record.cr_rzsj DESC
							) record
		
				
							  left join tb_nsryhxx xx on xx.nsryhxx_nsrsbh=record.cr_nsrsbh
		    <if test="districtType =='province'">
		    	where substring(xx.nsryhxx_swjgdm,2,2) in(select substring(pc.pc_code,1,2) from  tb_province_cities pc where pc.pc_id = #{pcId })
		    </if>
		    <if test="districtType== 'city' " >
			<if test="isChongQing != null and isChongQing == 'yes'">				
				where substring(xx.nsryhxx_swjgdm,2,6) in(select substring(pc.pc_code,2,6) from  tb_province_cities pc where pc.pc_id = #{pcId })
            </if>
            <if test="isChongQing != null and isChongQing == 'no'">
				where substring(xx.nsryhxx_swjgdm,2,4) in(select substring(pc.pc_code,1,4) from  tb_province_cities pc where pc.pc_id = #{pcId })
            </if>
		</if>
		<if test="districtType=='area' ">
		where substring(xx.nsryhxx_swjgdm,2,6) in(select substring(pc.pc_code,1,6) from  tb_province_cities pc where pc.pc_id = #{pcId })
		</if>
	<!-- 	    <if test="districtType =='province'">
		    	where exists (select 1 from tb_province_cities pc
				where SUBSTR(pc.pc_code,1,2)=SUBSTR(xx.nsryhxx_swjgdm,2,2)
				and (pc.pc_id = #{pcId } or pc.pc_pid = #{pcId }
				or pc.pc_pid in (select pcs.pc_id from tb_province_cities pcs where pcs.pc_pid = #{pcId } )))
		    </if>
		    <if test="districtType== 'city' " >
			<if test="isChongQing != null and isChongQing == 'yes'">
				where exists (select 1 from tb_province_cities pc
				where SUBSTR(pc.pc_code,1,6)=SUBSTR(xx.nsryhxx_swjgdm,2,6)
				and (pc.pc_id = #{pcId } or pc.pc_pid = #{pcId }
				or pc.pc_pid in (select pcs.pc_id from tb_province_cities pcs where pcs.pc_pid = #{pcId } )))
            </if>
            <if test="isChongQing != null and isChongQing == 'no'">
            	where exists (select 1 from tb_province_cities pc
            	where SUBSTR(pc.pc_code,1,4)=SUBSTR(xx.nsryhxx_swjgdm,2,4)
            	and (pc.pc_id = #{pcId } or pc.pc_pid = #{pcId }
				or pc.pc_pid in (select pcs.pc_id from tb_province_cities pcs where pcs.pc_pid = #{pcId } )))
            </if>
		</if>
		<if test="districtType=='area' ">
			where exists (select 1 from tb_province_cities pc 
			where SUBSTR(pc.pc_code,1,6)=SUBSTR(xx.nsryhxx_swjgdm,2,6)
			and (pc.pc_id = #{pcId } or pc.pc_pid = #{pcId }
			or pc.pc_pid in (select pcs.pc_id from tb_province_cities pcs where pcs.pc_pid = #{pcId } )))
		</if> -->
							group by record.cr_nsrsbh
				ORDER BY record.cr_rzsj DESC

		    
		</select>
		<update id="updateRZxx" parameterType="map">
	     update tb_check_record ar
	     set
	     <if test="cr_shjg != null and cr_shjg !='' ">
	    	  ar.cr_shjg=#{cr_shjg},
	    </if>
	 	<if test="cr_dbqk != null and cr_dbqk !=''">
        	 ar.cr_dbqk=#{cr_dbqk}
     	</if>
     
		 where ar.cr_sqdid=#{cr_sqdid}
	      
	
	</update> 
	
	
    	<select id="queryRzByPage" parameterType="map" resultMap="recordMap" flushCache="true" useCache="true">
		select  *
			from tb_check_record rc 
			
			<where>
				<if test="cr_sqdid != null and cr_sqdid != ''">
				rc.cr_sqdid=#{cr_sqdid}
				</if>
				<if test="cr_nsrsbh != null and cr_nsrsbh != ''">
				and rc.cr_nsrsbh =#{cr_nsrsbh}
				</if>
			</where>
			order by rc.cr_sqsj desc limit 1
	</select>
</mapper>