<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dcits.govsbu.sd.taxbankplatform.authorizationrecord.mapper.AuthorizationrecordMapper">
	<!--mybatis ehcache缓存配置,以下两个<cache>标签二选一,第一个可以输出日志,第二个不输出日志 -->
	<cache type="org.mybatis.caches.ehcache.LoggingEhcache"/> 
	<!-- <cache type="org.mybatis.caches.ehcache.EhcacheCache"/> -->

	<sql id="atAttributes">
		at_id,
		at_sqdid,
		at_sqsj,
		at_qymc,
		at_nsrsbh,
		at_sqkssj,
		at_sqjssj,
		at_sqzt,
		at_sqyy,
		org_id,
		fp_id,
		ag_id,
		at_frxm,
		at_frsfz,
		at_sjmc,
		createtime,
		updatetime
	</sql>

	<resultMap id="AuthorizationrecordMap" type="com.dcits.govsbu.sd.taxbankplatform.authorizationrecord.model.AuthorizationrecordEntity">
		<id property="at_id" column="at_id"/>
		<result property="at_sqdid" column="at_sqdid"/>
		<result property="at_sqsj" column="at_sqsj"/>
		<result property="at_qymc" column="at_qymc"/>
		<result property="at_nsrsbh" column="at_nsrsbh"/>
		<result property="at_sqkssj" column="at_sqkssj"/>
		<result property="at_sqjssj" column="at_sqjssj"/>
		<result property="at_sqzt" column="at_sqzt"/>
		<result property="at_sqyy" column="at_sqyy"/>
		<result property="sqzt" column="sqzt"/>
		<result property="sqjg" column="sqjg"/>
		<result property="org_id" column="org_id"/>
		<result property="fp_id" column="fp_id"/>
		<result property="ag_id" column="ag_id"/>
		<result property="at_frxm" column="at_frxm"/>
		<result property="at_frsfz" column="at_frsfz"/>
		<result property="at_sjmc" column="at_sjmc"/>
		<result property="at_sqsyxq" column="at_sqsyxq"/>
		<result property="la_id" column="la_id"/>
		<result property="upOrgId" column="up_org_id"/>
		<result property="createtime" column="createtime"/>
		<result property="updatetime" column="updatetime"/>
		<result property="grantCode" column="grantcode"/>
		<result property="authType" column="authtype"/>
		<association property="organizationEntity" column="org_id" javaType="com.dcits.govsbu.sd.taxbankplatform.organization.model.OrganizationEntity" > 
			<result property="orgname" column="orgname"/>
		</association>
		<association property="financialProduct" column="fp_id" javaType="com.dcits.govsbu.sd.taxbankplatform.financialProduct.model.FinancialProduct" > 
			<result property="fpName" column="fpName"/>
		</association>
		<association property="loanApplyQueryEntity" column="la_id" javaType="com.dcits.govsbu.sd.taxbankplatform.loanapplyquery.model.LoanApplyQueryEntity" > 
			<result property="la_amount" column="la_amount"/>
			<result property="la_repay_loan_deadline" column="la_repay_loan_deadline"/>
		</association>
		
	</resultMap>
	
	<select id="queryListByPage" parameterType="map" resultMap="AuthorizationrecordMap" flushCache="true" useCache="true">
		select ar.at_id,
		        ar.at_sqdid,
				ar.at_sqsj,
				ar.at_qymc,
				ar.at_nsrsbh,
				ar.at_sqkssj,
				ar.at_sqjssj,
				ar.at_sqzt,
				ar.at_sqyy,
				ar.sqzt,
				ar.sqjg,
				ar.org_id,
				ar.fp_id,
				ar.ag_id,
				ar.at_frxm,
				ar.at_frsfz,
				ar.at_sjmc,
				ar.createtime,
				ar.updatetime,
				ar.at_sqsyxq,
				ot.org_name,
				fp.fp_name,
				la.la_amount,
				la.la_repay_loan_deadline,
				ar.at_dkqx
			from tb_authorization_record ar 
			LEFT JOIN tb_organizations ot on ar.org_id=ot.org_id
			LEFT JOIN tb_financial_product fp on ar.fp_id=fp.fp_id
			LEFT JOIN tb_loan_apply la on ar.la_id=la.la_id
			<where>
				<if test="at_qymc != null and at_qymc != ''">
				ar.at_qymc like CONCAT('%',#{at_qymc},'%')
				</if>
				<if test="at_id != null and at_id != ''">
				ar.at_id =#{at_id}
				</if>
				<if test="at_nsrsbh != null and at_nsrsbh != ''">
				ar.at_nsrsbh =#{at_nsrsbh}
				</if>
			</where>
	</select>
	
	<select id="findById" parameterType="String" resultMap="AuthorizationrecordMap" flushCache="true" useCache="true">
		select  ar.at_id,
				ar.at_sqsj,
				ar.at_qymc,
				ar.at_nsrsbh,
				ar.at_sqkssj,
				ar.at_sqjssj,
				ar.at_sqzt,
				ar.at_sqyy,
				ar.org_id,
				ar.fp_id,
				ar.ag_id,
				ar.at_frxm,
				ar.at_frsfz,
				ar.at_sjmc,
				ar.createtime,
				ar.updatetime,
				ot.org_name,
				fp.fp_name,
				la.la_amount,
				la.la_repay_loan_deadline,
				ar.at_dkqx
			from tb_authorization_record ar 
			LEFT JOIN tb_organizations ot on ar.org_id=ot.org_id
			LEFT JOIN tb_financial_product fp on ar.fp_id=fp.fp_id
			LEFT JOIN tb_loan_apply la on ar.la_id=la.la_id
	    where ar.at_id = #{id} 
	</select>
	
    	<select id="querySqByPage" parameterType="map" resultMap="AuthorizationrecordMap" flushCache="true" useCache="true">
		select  ar.at_id,
		        ar.at_sqdid,
				ar.at_sqsj,
				ar.at_qymc,
				ar.at_nsrsbh,
				ar.at_sqkssj,
				ar.at_sqjssj,
				ar.at_sqzt,
				ar.at_sqyy,
				ar.sqzt,
				ar.sqjg,
				ar.org_id,
				ar.fp_id,
				ar.ag_id,
				ar.at_frxm,
				ar.at_frsfz,
				ar.at_sjmc,
				ar.createtime,
				ar.updatetime,
				ar.la_id,
				ar.at_sqsyxq,
				ot.org_name,
				fp.fp_name,
				la.la_amount,
				la.la_repay_loan_deadline,
				ar.at_dkqx
			from tb_authorization_record ar 
			LEFT JOIN tb_organizations ot on ar.org_id=ot.org_code
			LEFT JOIN tb_financial_product fp on ar.fp_id=fp.fp_id
			LEFT JOIN tb_loan_apply la on ar.la_id=la.la_id 
			
			<where>
				<if test="at_sqdid != null and at_sqdid != ''">
				ar.at_sqdid=#{at_sqdid}
				</if>
				<if test="at_nsrsbh != null and at_nsrsbh != ''">
				and ar.at_nsrsbh =#{at_nsrsbh}
				</if>
				<if test="isdkxx != null and isdkxx !=''">
				and ar.sqzt='sqjg001'
				</if>
			</where>
			order by ar.createtime desc limit 1
	</select>
 	<update id="updateSQxx" parameterType="map">
	     update tb_authorization_record  
	     　<set>
<!-- 	     <if test="at_sqzt != null and at_sqzt !='' ">
	    	  ar.at_sqzt=#{at_sqzt},
	    </if>
	 	<if test="at_sqyy != null and at_sqyy !=''">
        	 ar.at_sqyy=#{at_sqyy},
     	</if> -->
         <if test="sqzt != null and sqzt !='' ">
	    	  sqzt='${sqzt}',
	    </if>
	 	<if test="sqjg != null and sqjg !=''">
        	 sqjg='${sqjg}',
     	</if>
     		<if test="grantCode != null and grantCode !=''">
        	  grantcode='${grantCode}',
     	</if>
     		<if test="authType != null and authType !=''">
        	 authtype='${authType}',
     	</if>
     	
     	<if test="atSqkssj != null and atSqkssj !=''">
        	  at_sqkssj='${atSqkssj}',
     	</if>
     		<if test="atSqjssj != null and atSqjssj !=''">
        	  at_sqjssj='${atSqjssj}',
     	</if>
     	 <if test="authUpdateTime != null and authUpdateTime !=''">
        	  at_sqjssj='${authUpdateTime}',
     	</if>
     	</set>
		 where at_sqdid='${at_sqdid}'
	      
	
	</update> 
	<insert id="insert" parameterType="java.util.Map">
        insert into ${tablename}
        <foreach collection="keys" item="k" index="index" open="(" separator="," close=")">
            ${k}
        </foreach>
        values
        <foreach collection="keys" item="k" index="index" open="(" separator="," close=")">

              '${params[k]}'

        </foreach>
    </insert>
    
    <select id="findByGrantCode" parameterType="String" resultMap="AuthorizationrecordMap">
		select  ar.at_id,
				ar.at_sqsj,
				ar.at_qymc,
				ar.at_nsrsbh,
				ar.at_sqkssj,
				ar.at_sqjssj,
				ar.at_sqzt,
				ar.at_sqyy,
				ar.org_id,
				ar.fp_id,
				ar.ag_id,
				ar.at_frxm,
				ar.at_frsfz,
				ar.at_sjmc,
				ar.createtime,
				ar.updatetime,
		        ar.grantcode,
		        ar.authtype
			from tb_authorization_record ar 
			 
	    where ar.grantcode = #{grantCode}
	</select>

	
	
</mapper>